<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Responsive Timer</title>
  <style>
    :root {
      --accent-color: #f8924f;
      --dark-bg: #121212;
      --dial-bg: #1e1e1e;
      --text-color: #ffffff;
    }

    body {
      margin: 0;
      height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      background: var(--dark-bg);
      font-family: "Segoe UI", "Emirates Medium", sans-serif;
      color: var(--text-color);
    }

    .container {
      display: flex;
      align-items: center;
      gap: 16px;
      flex-direction: column;
    }

    canvas {
      width: 250px;
      height: 250px;
      max-width: 90vw;
      max-height: 90vw;
      touch-action: none;
    }

    .fake-player {
      width: 70px;
      height: 70px;
      border-radius: 50%;
      background: var(--accent-color);
      border: none;
      cursor: pointer;
      display: flex;
      justify-content: center;
      align-items: center;
      box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
      transition: transform 0.2s ease, opacity 0.3s ease;
      opacity: 0.4;
    }

    .fake-player.active {
      opacity: 1;
    }

    .fake-player:active {
      transform: scale(0.95);
    }

    .play-btn, .pause-btn {
      font-size: 30px;
      color: white;
      pointer-events: none;
      user-select: none;
    }

    .hidden {
      display: none;
    }

    @media (min-width: 600px) {
      .container {
        flex-direction: row;
        gap: 24px;
      }

      canvas {
        width: 220px;
        height: 220px;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <canvas id="dialCanvas" width="300" height="300"></canvas>
    <button class="fake-player" id="player">
      <span class="play-btn">▶</span>
      <span class="pause-btn hidden">⏸</span>
    </button>
  </div>

  <audio id="alarm" preload="auto">
    <source src="timer.mp3" type="audio/mpeg" />
  </audio>

  <script>
    const canvas = document.getElementById("dialCanvas");
    const ctx = canvas.getContext("2d");
    const center = { x: canvas.width / 2, y: canvas.height / 2 };
    const radius = 80;
    const maxSeconds = 3600;
    const increment = 60;

    let dragging = false, rawSeconds = 0, selectedSeconds = 0;
    let dialAdjusted = false, isRunning = false, timerInterval = null;
    let pulsing = false, pulseScale = 1, pulseDirection = 1, pulseFrame;

    const player = document.getElementById("player");
    const playBtn = player.querySelector(".play-btn");
    const pauseBtn = player.querySelector(".pause-btn");
    const alarm = document.getElementById("alarm");

    let audioUnlocked = false;
    document.addEventListener("click", () => {
      if (!audioUnlocked) {
        alarm.play().then(() => {
          alarm.pause(); alarm.currentTime = 0;
          audioUnlocked = true;
        }).catch(() => {});
      }
    }, { once: true });

    function secondsToTimeString(seconds) {
      const m = Math.floor(seconds / 60);
      const s = seconds % 60;
      return `${m.toString().padStart(2, "0")}:${s.toString().padStart(2, "0")}`;
    }

    function drawDial(glow = false, scale = 1) {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      ctx.save();
      ctx.translate(center.x, center.y);
      ctx.scale(scale, scale);
      ctx.translate(-center.x, -center.y);

      if (glow) {
        ctx.shadowBlur = 20;
        ctx.shadowColor = "#fff";
      }

      // Outer ring background
      ctx.beginPath();
      ctx.arc(center.x, center.y, radius + 12, 0, 2 * Math.PI);
      ctx.fillStyle = "#2b2b2b";
      ctx.fill();

      // Base track
      ctx.beginPath();
      ctx.arc(center.x, center.y, radius, 0, 2 * Math.PI);
      ctx.strokeStyle = "#444";
      ctx.lineWidth = 14;
      ctx.stroke();

      // Progress arc
      if (selectedSeconds > 0) {
        const end = -Math.PI / 2 + (selectedSeconds / maxSeconds) * 2 * Math.PI;
        ctx.beginPath();
        ctx.arc(center.x, center.y, radius, -Math.PI / 2, end);
        ctx.strokeStyle = "#f8924f";
        ctx.lineWidth = 14;
        ctx.stroke();
      }

      // Knob
      const angle = -Math.PI / 2 + (selectedSeconds / maxSeconds) * 2 * Math.PI;
      const knobX = center.x + radius * Math.cos(angle);
      const knobY = center.y + radius * Math.sin(angle);
      ctx.beginPath();
      ctx.arc(knobX, knobY, 7, 0, 2 * Math.PI);
      ctx.fillStyle = "#f8924f";
      ctx.fill();

      // Time text
      ctx.font = "bold 24px Segoe UI";
      ctx.fillStyle = "#ffffff";
      ctx.textAlign = "center";
      ctx.textBaseline = "middle";
      ctx.fillText(secondsToTimeString(Math.round(selectedSeconds)), center.x, center.y);

      ctx.restore();
    }

    function updateDialFromPointer(e) {
      const rect = canvas.getBoundingClientRect();
      const x = e.clientX - rect.left;
      const y = e.clientY - rect.top;
      const dx = x - center.x;
      const dy = y - center.y;
      const angle = Math.atan2(dy, dx) + Math.PI / 2;
      const normalized = (angle + 2 * Math.PI) % (2 * Math.PI);
      rawSeconds = (normalized / (2 * Math.PI)) * maxSeconds;

      if (rawSeconds >= 3540) rawSeconds = maxSeconds;

      selectedSeconds = rawSeconds;
      drawDial();
      if (!dialAdjusted && selectedSeconds > 0) {
        dialAdjusted = true;
        player.classList.add("active");
      }
    }

    function snapToIncrement() {
      selectedSeconds = Math.round(rawSeconds / increment) * increment;
      selectedSeconds = Math.min(Math.max(selectedSeconds, 0), maxSeconds);
      drawDial();
    }

    function pulse() {
      if (!pulsing) return;
      pulseScale += 0.01 * pulseDirection;
      if (pulseScale > 1.1 || pulseScale < 0.9) pulseDirection *= -1;
      drawDial(true, pulseScale);
      pulseFrame = requestAnimationFrame(pulse);
    }

    async function playAlarm() {
      try {
        alarm.pause(); alarm.currentTime = 0;
        await alarm.play();
      } catch (error) {}
      pulsing = true;
      pulse();
      setTimeout(() => alert("⏰ Time's up!"), 600);
    }

    function startTimer() {
      if (timerInterval) clearInterval(timerInterval);
      timerInterval = setInterval(() => {
        if (selectedSeconds > 0) {
          selectedSeconds = Math.max(selectedSeconds - 1, 0);
          drawDial();
        } else {
          pauseTimer();
          playAlarm();
        }
      }, 1000);
    }

    function pauseTimer() {
      clearInterval(timerInterval);
      timerInterval = null;
      isRunning = false;
      playBtn.classList.remove("hidden");
      pauseBtn.classList.add("hidden");
      if (pulsing) {
        cancelAnimationFrame(pulseFrame);
        pulsing = false;
        drawDial();
      }
    }

    canvas.addEventListener("pointerdown", (e) => {
      if (isRunning) return;
      dragging = true;
      updateDialFromPointer(e);
    });

    canvas.addEventListener("pointermove", (e) => {
      if (!dragging || isRunning) return;
      updateDialFromPointer(e);
    });

    canvas.addEventListener("pointerup", () => {
      if (dragging) snapToIncrement();
      dragging = false;
    });

    canvas.addEventListener("pointerleave", () => {
      if (dragging) snapToIncrement();
      dragging = false;
    });

    player.addEventListener("click", () => {
      if (!dialAdjusted && selectedSeconds === 0) return;
      if (isRunning) {
        pauseTimer();
      } else {
        isRunning = true;
        playBtn.classList.add("hidden");
        pauseBtn.classList.remove("hidden");
        startTimer();
      }
    });

    drawDial();
  </script>
</body>
</html>
